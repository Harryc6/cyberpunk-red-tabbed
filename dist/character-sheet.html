<head>
  <link href="main.css" rel="stylesheet">
</head>
<div class="cyberpunk-red">
  <div class="tabbed"><input type="radio" name="selecttab" value="1" class="tab tab1" checked="checked" /> <span class="tab accent-font">Character</span> <input type="radio" name="selecttab" value="2" class="tab tab2" /> <span class="tab accent-font">Skills</span> <input type="radio" name="selecttab" value="3" class="tab tab3" /> <span class="tab accent-font">Combat</span> <input type="radio" name="selecttab" value="4" class="tab tab4" /> <span class="tab accent-font">Gear</span> <input type="radio" name="selecttab" value="5" class="tab tab5" /> <span class="tab accent-font">Cyberware</span> <input type="radio" name="selecttab" value="6" class="tab tab6" /> <span class="tab accent-font">Lifepath</span> <input type="radio" name="selecttab" value="7" class="tab tab7" /> <span class="tab accent-font">Settings</span>
    <div class="tab-content tab1">
      <div>
        <div class="character-info">
          <h3 class="accent-font">Character</h3>
          <div class="columns">
            <div class="column"><span class="accent-font">Character Name</span> <input name="attr_charactername"></div>
            <div class="column"><span class="accent-font">Role</span> <select name="attr_role">
                <option value="Blank">Blank</option>
                <option value="Exec">Exec</option>
                <option value="Fixer">Fixer</option>
                <option value="Lawman">Lawman</option>
                <option value="Media">Media</option>
                <option value="Medtech">Medtech</option>
                <option value="Netrunner">Netrunner</option>
                <option value="Nomad">Nomad</option>
                <option value="Rockerboy">Rockerboy</option>
                <option value="Solo">Solo</option>
                <option value="Tech">Tech</option>
              </select></div>
            <div class="column"><span class="accent-font">Player Name</span> <input name="attr_playername"></div>
          </div>
        </div>
      </div>
      <div>
        <div class="section-attributes">
          <h3 class="accent-font">Attributes</h3>
          <div class="sheet-columns">
            <div class="sheet-column"><span class="accent-font">INT</span> <input type="number" name="attr_stat_int" /></div>
            <div class="sheet-column"><span class="accent-font">REF</span> <input type="number" name="attr_stat_ref" /></div>
            <div class="sheet-column"><span class="accent-font">DEX</span> <input type="number" name="attr_stat_dex" /></div>
            <div class="sheet-column"><span class="accent-font">TECH</span> <input type="number" name="attr_stat_tech" /></div>
            <div class="sheet-column"><span class="accent-font">COOL</span> <input type="number" name="attr_stat_cool" /></div>
            <div class="sheet-column"><span class="accent-font">WILL</span> <input type="number" name="attr_stat_will" /></div>
            <div class="sheet-column"><span class="accent-font">LUCK</span> <input type="number" name="attr_stat_luck" /></div>
            <div class="sheet-column"><span class="accent-font">MOVE</span> <input type="number" name="attr_stat_move" /></div>
            <div class="sheet-column"><span class="accent-font">BODY</span> <input type="number" name="attr_stat_body" /></div>
            <div class="sheet-column"><span class="accent-font">EMP</span> <input type="number" name="attr_stat_emp" /></div>
          </div>
        </div>
      </div>
      <div class="columns">
        <div class="column">
          <div class="section-hit-points">
            <h3 class="accent-font">Hit Points</h3><input type="number" name="attr_hp"> (of <span name="attr_hp_max"></span>)
          </div>
          <script type="text/worker">function updateHitPoints() {
  getAttrs(['stat_body', 'stat_will'], function (values) {
    var body = Number(values.stat_body);
    var will = Number(values.stat_will);
    var maxHp = Math.floor(((body + will) / 2) * 5 + 10);
    var halfHp = Math.floor(maxHp / 2);
    var deathSave = Math.floor(body);
    setAttrs({
      hp: maxHp,
      hp_max: maxHp,
      seriouslywounded: halfHp,
      deathsave: deathSave
    });
  });
}
on('change:stat_body change:stat_will', function() {
  updateHitPoints();
});</script>
        </div>
        <div class="column">
          <div class="section-luck">
            <h3 class="accent-font">Luck</h3><input type="number" name="attr_luck" /> (of <span name="attr_luck_max"></span>)
          </div>
          <script type="text/worker">function updateLuck() {
    getAttrs(['stat_luck'], function(values) {
      var luck = Number(values.stat_luck);
      setAttrs({
        luck: luck,
        luck_max: luck
      })
    });
  }
  on('change:stat_luck', function() {
    updateLuck();
  });</script>
        </div>
      </div>
      <div>
        <div class="section-role" style="padding:50px;">
          <h3 class="accent-font">Exact code taken from Kitchensink.</h3>
          <fieldset class="repeating_kitchensinks"><select name="attr_dtype" class="dtype">
              <option value="d4">d4</option>
              <option value="d6">d6</option>
              <option value="d8">d8</option>
              <option value="d10">d10</option>
              <option value="d12">d12</option>
            </select> <input name="attr_skillname" /></fieldset>
        </div>
      </div>
      <div>
        <div class="section-dice-roller">
          <h3 class="accent-font">Dice roller</h3>Show Dice Rollers? <input type="checkbox" name="attr_hidedicerollers" value="0" class="show-next-div" />
          <div>
            <div class="columns">
              <div class="column"><button type="roll" name="roll_1d10" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll 1d10}} {{roll=[[1d10]]}}">Roll 1d10</button></div>
              <div class="column"><button type="roll" name="roll_d6" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll @{rollnd6}d6}} {{roll=[[@{rollnd6}d6]]}}">Roll</button> <select name="attr_rollnd6" style="width: 5rem">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select> d6</div>
              <div class="column"><button type="roll" name="roll_1d100" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll 1d100}} {{roll=[[1d100]]}}">Roll 1d100</button></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-content tab2">
      <div class="section-modifiers">
        <div class="modifiers"><input type="hidden" name="attr_finalmodifier" />
          <h3 class="accent-font">Modifiers <span name="attr_finalmodifierdisplay"></span> <span class="faux-button">Reset <input type="checkbox" name="attr_resetmodifiers"/></span></h3>Show Modifiers? <input type="checkbox" name="attr_hidemodifiers" class="show-next-div" />
          <div class="toggle-container">
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_damageserious" /> damage: serious</div>
              <div class="column"><input type="checkbox" name="attr_damagemortal" /> damage: mortal</div>
              <div class="column"><input type="checkbox" name="attr_understress" /> under stress</div>
              <div class="column"><input type="checkbox" name="attr_neverdonebefore" /> never done before</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_nightorlowlight" /> night or low light</div>
              <div class="column"><input type="checkbox" name="attr_obscured" /> obscured by smoke or darkness</div>
              <div class="column"><input type="checkbox" name="attr_complextask" /> complex task</div>
              <div class="column"><input type="checkbox" name="attr_wrongtoolsorparts" /> wrong tools or parts</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_drunkdrugged" /> drunk or drugged</div>
              <div class="column"><input type="checkbox" name="attr_secretly" /> attempting secretly</div>
              <div class="column"><input type="checkbox" name="attr_lostfacedown" /> lost facedown</div>
              <div class="column"><input type="checkbox" name="attr_aimedshot" /> aimed shot</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_complimentaryskill" /> complimentary skill</div>
              <div class="column"><input type="checkbox" name="attr_extratime" /> spend extra time</div>
              <div class="column">Other/custom: <input type="number" name="attr_custommod" /></div>
              <div class="column">Luck points spent <select name="attr_luckmod">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select></div>
            </div>
          </div>
        </div>
      </div>
      <script type="text/worker">/**
   * Convert from Roll20's handling of checkbox values to
   * Boolean values for control flows.
   */
  function getCheckboxAsBoolean(val) {
    // Additional logic to handle the custommod and luckmod fields
    if (Number(val) && Number(val) !== 0) {
      return true;
    }
    return val === 'on' ? true : false;
  }
  /**
   * A list of modifiers that we can iterate through with a
   * name that matches an ATTR value stored by the sheet and
   * the actual numerical modifier to be applied to die rolls.
   */
  function modifiersList() {
    return [
      { name: 'nightorlowlight', value: -1 },
      { name: 'neverdonebefore', value: -1 },
      { name: 'complextask', value: -2 },
      { name: 'wrongtoolsorparts', value: -2 },
      { name: 'understress', value: -2 },
      { name: 'drunkdrugged', value: -4 },
      { name: 'secretly', value: -4 },
      { name: 'obscured', value: -4 },
      { name: 'damageserious', value: -2 },
      { name: 'damagemortal', value: -4 },
      { name: 'lostfacedown', value: -2 },
      { name: 'complimentaryskill', value: 1 },
      { name: 'extratime', value: 1 },
      { name: 'aimedshot', value: -8 },
      { name: 'luckmod', value: 'luckmod' },
      { name: 'custommod', value: 'custommod' }
    ];
  }
  /**
   * Get modifiers as an array of names as Strings.
   */
  function getModifierNames() {
    var modifiers = modifiersList();
    var modifierNames = [];
    modifiers.forEach((modifier) => {
      modifierNames.push(modifier.name);
    });
    return modifierNames;
  }
  /**
   * Given the namme of a modifier return the numerical modifier
   * to be applied to die rolls.
   */
  function getModifierValueByName(name) {
    // LUCK and CUSTOM are special cases that map directly
    // to attr values stored in the sheet.
    if (name === 'luckmod' || name === 'custommod') {
      getAttrs([name], function (values) {
        return values[name];
      });
    }
    // MOST MODIFIERS are static numbers that have their values
    // stored as part of the data structure in modifiersList().
    var modifiers = modifiersList();
    return modifiers.find((modifier) => modifier.name === name).value;
  }
  /**
   * Calculate the final modifier...
   */
  function calculateFinalModifier() {
    var calculatedFinalModifier = 0;
    getAttrs(getModifierNames(), function (values) {
      for (var [key, value] of Object.entries(values)) {
        if (getCheckboxAsBoolean(value)) {
          if (key === 'luckmod' || key === 'custommod') {
            calculatedFinalModifier += Number(values[key]);
          } else {
            calculatedFinalModifier += Number(getModifierValueByName(key));
          }
        }
      }
      if (calculatedFinalModifier === 0) {
        calculatedFinalModifier = '0';
      }
      setAttrs({
        finalmodifier: calculatedFinalModifier
      });
    });
  }
  // Get the (formatted) list of modifier fields to monitor for changes
  function eventsModifiers() {
    var modifiers = getModifierNames();
    var modifiersList = '';
    modifiers.forEach((modifier) => {
      modifiersList += 'change:' + modifier + ' ';
    });
    return modifiersList;
  }
  /**
   * When a modifier checkbox changes, trigger the re-calculation of
   * the finalmodifier.
   */
  on(eventsModifiers(), function () {
    calculateFinalModifier();
  });
  /**
   * When the finalmodifier changes re-write the display version of
   * the calculated modifier
   */
  on('change:finalmodifier', function () {
    getAttrs(['finalmodifier', 'finalmodifierdisplay'], function (values) {
      var modifier = Number(values.finalmodifier);
      var formattedmodifier = ' ';
      if (modifier > 0) {
        formattedmodifier = '(+' + modifier + ')';
      }
      if (modifier < 0) {
        formattedmodifier = '(' + modifier + ')';
      }
      setAttrs({
        finalmodifierdisplay: formattedmodifier
      });
    });
  });
  /**
   * Single function to reset all modifiers
   */
  function resetAllModifiers() {
    var modifiers = getModifierNames();
    var attrsToSet = {};
    getAttrs(modifiers, function (values) {
      for (var [key, value] of Object.entries(values)) {
        attrsToSet[key] = '0';
      }
      setAttrs(attrsToSet);
    });
  }
  /**
   * Event handler to trigger reset of all modifiers
   */
  on('change:resetmodifiers', function () {
    resetAllModifiers();
  });</script>
      <div class="section-skills">
        <div class="skills-list-grouped">
          <div class="skill-group">
            <h4 class="accent-font">Awareness Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_concealrevealobject"> <button class="button-plain" type="roll">Conceal/Reveal Object</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_concentration"> <button class="button-plain" type="roll">Concentration</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_lipreading"> <button class="button-plain" type="roll">Lip Reading</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_perception"> <button class="button-plain" type="roll">Perception</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_tracking"> <button class="button-plain" type="roll">Tracking</button></div>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Body Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_athletics"> <button class="button-plain" type="roll">Athletics</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_contrortionist"> <button class="button-plain" type="roll">Contrortionist</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_dance"> <button class="button-plain" type="roll">Dance</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_endurance"> <button class="button-plain" type="roll">Endurance</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_resisttorturedrugs"> <button class="button-plain" type="roll">Resist Torture/Drugs</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_stealth"> <button class="button-plain" type="roll">Stealth</button></div>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Control Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_landvehicle"> <button class="button-plain" type="roll">Control Land Vehicle</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_airvehicle"> <button class="button-plain" type="roll">Pilot Air Vehicle (x2)</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_seavehicle"> <button class="button-plain" type="roll">Pilot Sea Vehicle</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_riding"> <button class="button-plain" type="roll">Riding</button></div>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Education Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_accounting"> <button class="button-plain" type="roll">Accounting</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_animalhandling"> <button class="button-plain" type="roll">Animal Handling</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_bureaucracy"> <button class="button-plain" type="roll">Bureaucracy</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_business"> <button class="button-plain" type="roll">Business</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_composition"> <button class="button-plain" type="roll">Composition</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_criminology"> <button class="button-plain" type="roll">Criminology</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_cryptography"> <button class="button-plain" type="roll">Cryptography</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_deduction"> <button class="button-plain" type="roll">Deduction</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_education"> <button class="button-plain" type="roll">Education</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_gamble"> <button class="button-plain" type="roll">Gamble</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_librarysearch"> <button class="button-plain" type="roll">Library Search</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_tactics"> <button class="button-plain" type="roll">Tactics</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_wildernesssurvival"> <button class="button-plain" type="roll">Wilderness Survival</button></div>
              </li>
              <li>
                <h5 class="accent-font">Languages</h5>
                <fieldset class="repeating_languages">
                  <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skillvalue"> <span class="skill-indent-icon">&#8627;</span> <button class="button-plain" type="roll"></button> <input class="skill-name" name="attr_skillname"></div>
                </fieldset>
              </li>
              <li>
                <h5 class="accent-font">Local Expert</h5>
                <fieldset class="repeating_localexperts">
                  <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skillvalue"> <span class="skill-indent-icon">&#8627;</span> <button class="button-plain" type="roll"></button> <input class="skill-name" name="attr_skillname"></div>
                </fieldset>
              </li>
              <li>
                <h5 class="accent-font">Science</h5>
                <fieldset class="repeating_sciences">
                  <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skillvalue"> <span class="skill-indent-icon">&#8627;</span> <button class="button-plain" type="roll"></button> <input class="skill-name" name="attr_skillname"></div>
                </fieldset>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Fighting Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_brawling"> <button class="button-plain" type="roll">Brawling</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_evasion"> <button class="button-plain" type="roll">Evasion</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_meleeweapon"> <button class="button-plain" type="roll">Melee Weapon</button></div>
              </li>
              <li>
                <h5 class="accent-font">Martial Arts (x2)</h5>
                <fieldset class="repeating_martialarts">
                  <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skillvalue"> <span class="skill-indent-icon">&#8627;</span> <button class="button-plain" type="roll"></button> <input class="skill-name" name="attr_skillname"></div>
                </fieldset>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Performance Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_acting"> <button class="button-plain" type="roll">Acting</button></div>
              </li>
              <li>
                <h5 class="accent-font">Play Instrument</h5>
                <fieldset class="repeating_playinstrument">
                  <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skillvalue"> <span class="skill-indent-icon">&#8627;</span> <button class="button-plain" type="roll"></button> <input class="skill-name" name="attr_skillname"></div>
                </fieldset>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Ranged Weapon Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_archery"> <button class="button-plain" type="roll">Archery</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_autofire"> <button class="button-plain" type="roll">Autofire (x2)</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_handgun"> <button class="button-plain" type="roll">Handgun</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_heavyweapons"> <button class="button-plain" type="roll">Heavy Weapons</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_shoulderarms"> <button class="button-plain" type="roll">Shoulder Arms</button></div>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Social Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_bribery"> <button class="button-plain" type="roll">Bribery</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_conversation"> <button class="button-plain" type="roll">Conversation</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_humanperception"> <button class="button-plain" type="roll">Human Perception</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_interrogation"> <button class="button-plain" type="roll">Interrogation</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_personalgrooming"> <button class="button-plain" type="roll">Personal Grooming</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_persuasion"> <button class="button-plain" type="roll">Persuasion</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_bribery"> <button class="button-plain" type="roll">Streetwise</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_bribery"> <button class="button-plain" type="roll">Trading</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_wardrobestyle"> <button class="button-plain" type="roll">Wardrobe & Style</button></div>
              </li>
            </ul>
          </div>
          <div class="skill-group">
            <h4 class="accent-font">Technique Skills</h4>
            <ul class="list-plain">
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_airevehicletech"> <button class="button-plain" type="roll">Air Vehicle Tech</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_basictech"> <button class="button-plain" type="roll">Basic Tech</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_cybertech"> <button class="button-plain" type="roll">Cybertech</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_demolitions"> <button class="button-plain" type="roll">Demolitions (x2)</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_electronicssecurity"> <button class="button-plain" type="roll">Electronics/Security Tech (x2)</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_forgery"> <button class="button-plain" type="roll">Forgery</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_firstaid"> <button class="button-plain" type="roll">First Aid</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_landvehicletech"> <button class="button-plain" type="roll">Land Vehicle Tech</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_paintdrawsculpt"> <button class="button-plain" type="roll">Paint/Draw/Sculpt</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_paramedic"> <button class="button-plain" type="roll">Paramedic (x2)</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_photographyfilm"> <button class="button-plain" type="roll">Photography/Film</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_picklock"> <button class="button-plain" type="roll">Pick Lock</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_pickpocket"> <button class="button-plain" type="roll">Pick Pocket</button></div>
              </li>
              <li>
                <div class="skill"><input class="skill-value" type="number" value="0" name="attr_skill_weaponstech"> <button class="button-plain" type="roll">Weaponstech</button></div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-content tab3">
      <div class="section-modifiers">
        <div class="modifiers"><input type="hidden" name="attr_finalmodifier" />
          <h3 class="accent-font">Modifiers <span name="attr_finalmodifierdisplay"></span> <span class="faux-button">Reset <input type="checkbox" name="attr_resetmodifiers"/></span></h3>Show Modifiers? <input type="checkbox" name="attr_hidemodifiers" class="show-next-div" />
          <div class="toggle-container">
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_damageserious" /> damage: serious</div>
              <div class="column"><input type="checkbox" name="attr_damagemortal" /> damage: mortal</div>
              <div class="column"><input type="checkbox" name="attr_understress" /> under stress</div>
              <div class="column"><input type="checkbox" name="attr_neverdonebefore" /> never done before</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_nightorlowlight" /> night or low light</div>
              <div class="column"><input type="checkbox" name="attr_obscured" /> obscured by smoke or darkness</div>
              <div class="column"><input type="checkbox" name="attr_complextask" /> complex task</div>
              <div class="column"><input type="checkbox" name="attr_wrongtoolsorparts" /> wrong tools or parts</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_drunkdrugged" /> drunk or drugged</div>
              <div class="column"><input type="checkbox" name="attr_secretly" /> attempting secretly</div>
              <div class="column"><input type="checkbox" name="attr_lostfacedown" /> lost facedown</div>
              <div class="column"><input type="checkbox" name="attr_aimedshot" /> aimed shot</div>
            </div>
            <div class="columns">
              <div class="column"><input type="checkbox" name="attr_complimentaryskill" /> complimentary skill</div>
              <div class="column"><input type="checkbox" name="attr_extratime" /> spend extra time</div>
              <div class="column">Other/custom: <input type="number" name="attr_custommod" /></div>
              <div class="column">Luck points spent <select name="attr_luckmod">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select></div>
            </div>
          </div>
        </div>
      </div>
      <script type="text/worker">/**
   * Convert from Roll20's handling of checkbox values to
   * Boolean values for control flows.
   */
  function getCheckboxAsBoolean(val) {
    // Additional logic to handle the custommod and luckmod fields
    if (Number(val) && Number(val) !== 0) {
      return true;
    }
    return val === 'on' ? true : false;
  }
  /**
   * A list of modifiers that we can iterate through with a
   * name that matches an ATTR value stored by the sheet and
   * the actual numerical modifier to be applied to die rolls.
   */
  function modifiersList() {
    return [
      { name: 'nightorlowlight', value: -1 },
      { name: 'neverdonebefore', value: -1 },
      { name: 'complextask', value: -2 },
      { name: 'wrongtoolsorparts', value: -2 },
      { name: 'understress', value: -2 },
      { name: 'drunkdrugged', value: -4 },
      { name: 'secretly', value: -4 },
      { name: 'obscured', value: -4 },
      { name: 'damageserious', value: -2 },
      { name: 'damagemortal', value: -4 },
      { name: 'lostfacedown', value: -2 },
      { name: 'complimentaryskill', value: 1 },
      { name: 'extratime', value: 1 },
      { name: 'aimedshot', value: -8 },
      { name: 'luckmod', value: 'luckmod' },
      { name: 'custommod', value: 'custommod' }
    ];
  }
  /**
   * Get modifiers as an array of names as Strings.
   */
  function getModifierNames() {
    var modifiers = modifiersList();
    var modifierNames = [];
    modifiers.forEach((modifier) => {
      modifierNames.push(modifier.name);
    });
    return modifierNames;
  }
  /**
   * Given the namme of a modifier return the numerical modifier
   * to be applied to die rolls.
   */
  function getModifierValueByName(name) {
    // LUCK and CUSTOM are special cases that map directly
    // to attr values stored in the sheet.
    if (name === 'luckmod' || name === 'custommod') {
      getAttrs([name], function (values) {
        return values[name];
      });
    }
    // MOST MODIFIERS are static numbers that have their values
    // stored as part of the data structure in modifiersList().
    var modifiers = modifiersList();
    return modifiers.find((modifier) => modifier.name === name).value;
  }
  /**
   * Calculate the final modifier...
   */
  function calculateFinalModifier() {
    var calculatedFinalModifier = 0;
    getAttrs(getModifierNames(), function (values) {
      for (var [key, value] of Object.entries(values)) {
        if (getCheckboxAsBoolean(value)) {
          if (key === 'luckmod' || key === 'custommod') {
            calculatedFinalModifier += Number(values[key]);
          } else {
            calculatedFinalModifier += Number(getModifierValueByName(key));
          }
        }
      }
      if (calculatedFinalModifier === 0) {
        calculatedFinalModifier = '0';
      }
      setAttrs({
        finalmodifier: calculatedFinalModifier
      });
    });
  }
  // Get the (formatted) list of modifier fields to monitor for changes
  function eventsModifiers() {
    var modifiers = getModifierNames();
    var modifiersList = '';
    modifiers.forEach((modifier) => {
      modifiersList += 'change:' + modifier + ' ';
    });
    return modifiersList;
  }
  /**
   * When a modifier checkbox changes, trigger the re-calculation of
   * the finalmodifier.
   */
  on(eventsModifiers(), function () {
    calculateFinalModifier();
  });
  /**
   * When the finalmodifier changes re-write the display version of
   * the calculated modifier
   */
  on('change:finalmodifier', function () {
    getAttrs(['finalmodifier', 'finalmodifierdisplay'], function (values) {
      var modifier = Number(values.finalmodifier);
      var formattedmodifier = ' ';
      if (modifier > 0) {
        formattedmodifier = '(+' + modifier + ')';
      }
      if (modifier < 0) {
        formattedmodifier = '(' + modifier + ')';
      }
      setAttrs({
        finalmodifierdisplay: formattedmodifier
      });
    });
  });
  /**
   * Single function to reset all modifiers
   */
  function resetAllModifiers() {
    var modifiers = getModifierNames();
    var attrsToSet = {};
    getAttrs(modifiers, function (values) {
      for (var [key, value] of Object.entries(values)) {
        attrsToSet[key] = '0';
      }
      setAttrs(attrsToSet);
    });
  }
  /**
   * Event handler to trigger reset of all modifiers
   */
  on('change:resetmodifiers', function () {
    resetAllModifiers();
  });</script>
      <div class="section-combat">
        <h3 class="accent-font">Combat</h3>
        <div class="combat-weapons">
          <h3>Weapons</h3>
          <fieldset class="repeating_weapons">
            <div class="weapon">
              <div class="columns">
                <div class="column">
                  <div class="accent-font">Name</div><input name="attr_weaponname" />
                </div>
                <div class="column">
                  <div class="accent-font">Skill</div><select name="attr_weaponskill">
                    <optgroup label="Melee">
                      <option value="brawling">Brawling</option>
                      <option value="meleeweapon">Melee Weapon</option>
                      <option value="martialarts">Martial Arts</option>
                    </optgroup>
                    <optgroup label="Ranged">
                      <option value="archery">Archery</option>
                      <option value="handgun">Handgun</option>
                      <option value="heavyweapons">Heavy Weapons</option>
                      <option value="shoulderarms">Shoulder Arms</option>
                    </optgroup>
                  </select>
                </div>
                <div class="column">
                  <div class="accent-font">Damage</div><select class="narrow" name="attr_weapondamage">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>d6
                </div>
                <div class="column">
                  <div class="accent-font">Magazine</div><input class="narrow" name="attr_weaponmagazine" />
                </div>
                <div class="column">
                  <div class="accent-font"><abbr title="Rate of Fire">RoF</abbr></div><select class="narrow" name="attr_weaponrof">
                    <option value="1">1</option>
                    <option value="2">2</option>
                  </select>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="weapon-ammotype"><span class="accent-font">Ammo Type</span> <input name="attr_weaponammotype" /></div>
                  <div class="weapon-concealable"><span class="accent-font"><input type="checkbox" name="attr_weaponconcealable"/> Concealable</span></div>
                </div>
                <div class="column column-3">
                  <div class="accent-font">Notes</div><textarea name="attr_weaponnotes" rows="3"></textarea>
                </div>
              </div>
              <div class="actions"><button type="roll" name="roll_1d10" value="&{template:attack}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Attack: @{weapon_name}}} {{roll=[[1d10]]}}">Attack</button> <button type="roll" name="roll_1d10" value="&{template:attack}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Attack: @{weapon_name}}} {{roll=[[1d10]]}}">Damage</button></div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <div class="tab-content tab4">
      <div class="section-gear">
        <h3 class="accent-font">Gear</h3>
      </div>
    </div>
    <div class="tab-content tab5">
      <div class="section-cyberware">
        <h3 class="accent-font">Cyberware</h3>
      </div>
    </div>
    <div class="tab-content tab6">
      <div class="section-lifepath">
        <h3 class="accent-font">Lifepath</h3>
        <div class="columns">
          <div class="column">
            <div><span class="accent-font">Cultural Origins</span><textarea name="attr_lp_culture"></textarea></div>
            <div><span class="accent-font">Clothing Style</span><textarea name="attr_lp_clothing"></textarea></div>
            <div><span class="accent-font">What do you value most?</span><textarea name="attr_lp_whatdoyouvalue"></textarea></div>
            <div><span class="accent-font">Most valued person</span><textarea name="attr_lp_mostvaluedperson"></textarea></div>
            <div><span class="accent-font">Family Background</span><textarea name="attr_lp_familybackground"></textarea></div>
            <div><span class="accent-font">Family Crisis</span><textarea name="attr_lp_familycrisis"></textarea></div>
          </div>
          <div class="column">
            <div><span class="accent-font">Personality</span><textarea name="attr_lp_personality"></textarea></div>
            <div><span class="accent-font">Hairstyle</span><textarea name="attr_lp_hairstyle"></textarea></div>
            <div><span class="accent-font">Feelings about people</span><textarea name="attr_lp_feelingsaboutpeople"></textarea></div>
            <div><span class="accent-font">Most valued possession</span><textarea name="attr_lp_mostvaluedpossession"></textarea></div>
            <div><span class="accent-font">Childhood environment</span><textarea name="attr_lp_childhoodenv"></textarea></div>
            <div><span class="accent-font">Life Goals</span><textarea name="attr_lp_lifegoals"></textarea></div>
          </div>
        </div>
        <div class="columns">
          <div class="column">
            <h4 class="accent-font">Friends</h4>
            <fieldset class="repeating_friends">
              <div><textarea name="attr_lp_friend"></textarea></div>
            </fieldset>
          </div>
          <div class="column">
            <h4 class="accent-font">Tragic Love Affairs</h4>
            <fieldset class="repeating_loveaffairs">
              <div><textarea name="attr_lp_loveaffair"></textarea></div>
            </fieldset>
          </div>
        </div>
        <div>
          <h4 class="accent-font">Enemies</h4>
          <div class="columns">
            <div class="column">Who?</div>
            <div class="column">What caused it?</div>
            <div class="column">What can they throw at you?</div>
            <div class="column">What's gonna happen?</div>
          </div>
          <fieldset class="repeating_enemies">
            <div class="columns">
              <div class="column"><textarea name="attr_lp_enemywho"></textarea></div>
              <div class="column"><textarea name="attr_lp_enemycause"></textarea></div>
              <div class="column"><textarea name="attr_lp_enemythrow"></textarea></div>
              <div class="column"><textarea name="attr_lp_enemyhappen"></textarea></div>
            </div>
          </fieldset>
        </div>
      </div>
    </div>
    <div class="tab-content tab7">
      <div class="section-settings">
        <h3 class="accent-font">Settings</h3>
        <div class="setting-color">
          <h4 class="accent-font">Color</h4><select name="attr_templatecolor">
            <option value="black">Black</option>
            <option value="red">Red</option>
            <option value="blue">Blue</option>
            <option value="green">Green</option>
            <option value="brown">Brown</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  <rolltemplate class="sheet-rolltemplate-attack">
    <div class="{{ templatecolor }}">
      <div>(attack roll)</div>
      <div class="character">{{#charactername}}{{ charactername }}{{/charactername}}</div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>{{#rollWasCrit() roll}}
        <div class="crit">CRITICAL SUCCESS!<br />Add {{ critroll }} to roll</div>
      {{/rollWasCrit() roll}} {{#rollWasFumble() roll}}
        <div class="fail">CRITICAL FAILURE!<br />Subtract {{ critroll }} from roll</div>
      {{/rollWasFumble() roll}} {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>
  <rolltemplate class="sheet-rolltemplate-basic"><input type="hidden" name="attr_templatecolor" />
    <div class="sheet-templatecolor-wrapper">
      <div>(basic roll)</div>
      <div class="character">{{#charactername}}{{ charactername }}{{/charactername}}</div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>{{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>
  <rolltemplate class="sheet-rolltemplate-damage">
    <div class="{{ templatecolor }}">
      <div>(damage roll)</div>
      <div class="character">{{#charactername}}{{ charactername }}{{/charactername}}</div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>{{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>
  <rolltemplate class="sheet-rolltemplate-skill">
    <div class="{{ templatecolor }}">
      <div>(skill roll)</div>
      <div class="character">{{#charactername}}{{ charactername }}{{/charactername}}</div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>{{#rollWasCrit() roll}}
        <div class="crit">CRITICAL SUCCESS! Add {{ critroll }} to roll</div>
      {{/rollWasCrit() roll}} {{#rollWasFumble() roll}}
        <div class="fail">CRITICAL FAILURE! Subtract {{ critroll }} from roll</div>
      {{/rollWasFumble() roll}} {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>
</div>
<script src="main.js"></script>