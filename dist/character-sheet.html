<head>
  <link href="main.css" rel="stylesheet">
</head>
<div class="cyberpunk-red">
  <!-- Character sheet parts... -->
  <div class="tabbed">
    <!-- tab controls -->
    <input type="radio" name="selecttab" value="1" class="tab tab1" checked />
    <span class="tab accent-font">Character</span>
    <input type="radio" name="selecttab" value="2" class="tab tab2" />
    <span class="tab accent-font">Skills</span>
    <input type="radio" name="selecttab" value="3" class="tab tab3" />
    <span class="tab accent-font">Combat</span>
    <input type="radio" name="selecttab" value="4" class="tab tab4" />
    <span class="tab accent-font">Gear</span>
    <input type="radio" name="selecttab" value="5" class="tab tab5" />
    <span class="tab accent-font">Cyberware</span>
    <input type="radio" name="selecttab" value="6" class="tab tab6" />
    <span class="tab accent-font">Lifepath</span>
    <!-- <input type="radio" name="selecttab" value="7" class="tab tab7" />
    <span class="tab accent-font">Settings</span> -->

    <div class="tab-content tab1">
      <div>
        <div class="character-info">
          <div class="columns">
            <div class="column">
              <h4>Handle</h4>
              <input type="text" name="attr_charactername" />
            </div>
            <div class="column">
              <h4>Role</h4>
              <select name="attr_role">

                <option value="Blank">Blank</option>

                <option value="Exec">Exec</option>

                <option value="Fixer">Fixer</option>

                <option value="Lawman">Lawman</option>

                <option value="Media">Media</option>

                <option value="Medtech">Medtech</option>

                <option value="Netrunner">Netrunner</option>

                <option value="Nomad">Nomad</option>

                <option value="Rockerboy">Rockerboy</option>

                <option value="Solo">Solo</option>

                <option value="Tech">Tech</option>

              </select>
            </div>
            <!-- <div class="column">
      <div class="accent-font">Player Name</div>
      <input type="text" name="attr_playername" />
    </div> -->
          </div>
        </div>

      </div>
      <div>
        <div class="section-attributes">
          <div class="sheet-columns">

            <div class="sheet-column">
              <span class="accent-font">INT</span>
              <input type="number" name="attr_stat_int" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">REF</span>
              <input type="number" name="attr_stat_ref" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">DEX</span>
              <input type="number" name="attr_stat_dex" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">TECH</span>
              <input type="number" name="attr_stat_tech" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">COOL</span>
              <input type="number" name="attr_stat_cool" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">WILL</span>
              <input type="number" name="attr_stat_will" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">LUCK</span>
              <input type="number" name="attr_stat_luck" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">MOVE</span>
              <input type="number" name="attr_stat_move" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">BODY</span>
              <input type="number" name="attr_stat_body" />
            </div>

            <div class="sheet-column">
              <span class="accent-font">EMP</span>
              <input type="number" name="attr_stat_emp" />
            </div>

          </div>
        </div>

      </div>
      <div class="columns">
        <div class="column">
          <div class="section-empathy">
            <h4>Empathy</h4>
            <div class="field-wrapper center">
              <strong><span name="attr_empathy"></span></strong> of
              <span name="attr_stat_emp"></span>
            </div>
          </div>
          <script type="text/worker">
            function updateEmpathy() {
    getAttrs(['stat_emp'], function(values) {
      var empathy = Number(values.stat_emp);
      setAttrs({
        empathy: empathy,
        empathy_max: empathy
      })
    });
  }
  on('change:stat_emp', function() {
    updateEmpathy();
  });
</script>

        </div>
        <div class="column">
          <div class="section-humanity">
            <h4>Humanity</h4>
            <div class="field-wrapper center">
              <input type="number" name="attr_humanity" /> of
              <span name="attr_humanity_max"></span>
            </div>
          </div>
          <script type="text/worker">
            function updateHumanity() {
    getAttrs(['stat_emp'], function(values) {
      var empathy = Number(values.stat_emp);
      setAttrs({
        humanity: empathy * 10,
        humanity_max: empathy * 10
      })
    });
  }
  on('change:stat_emp', function() {
    updateHumanity();
  });
  function updateEmpathyFromHumanity() {
    getAttrs(['humanity'], function(values){
      var humanity = Number(values.humanity);
      setAttrs({
        empathy: Math.floor(humanity / 10)
      });
    });
  }
  on('change:humanity', function() {
    updateEmpathyFromHumanity();
  });
</script>

        </div>
        <div class="column">
          <div class="section-luck">
            <h4>Luck</h4>
            <div class="field-wrapper center">
              <input type="number" name="attr_luck" />
              of <span name="attr_luck_max"></span>
            </div>
          </div>
          <script type="text/worker">
            function updateLuck() {
    getAttrs(['stat_luck'], function(values) {
      var luck = Number(values.stat_luck);
      setAttrs({
        luck: luck,
        luck_max: luck
      })
    });
  }
  on('change:stat_luck', function() {
    updateLuck();
  });
</script>

        </div>
        <div class="column">
          <div class="section-hit-points">
            <h4>Hit Points</h4>
            <div class="field-wrapper center">
              <input type="number" name="attr_hp" />
              of <span name="attr_hp_max"></span>
            </div>
            <!-- 
    <div class="hit-points-meta">
      <span class="hit-points-meta-value" name="attr_seriouslywounded"></span>
      <button class="death-save" type="roll">
        Death Save (<span name="attr_deathsave"></span>)
      </button>
    </div>
  -->
          </div>
          <script type="text/worker">
            function updateHitPoints() {
    getAttrs(['stat_body', 'stat_will'], function (values) {
      var body = Number(values.stat_body);
      var will = Number(values.stat_will);
      var maxHp = Math.floor(((body + will) / 2) * 5 + 10);
      var halfHp = Math.floor(maxHp / 2);
      var deathSave = Math.floor(body);
      setAttrs({
        hp: maxHp,
        hp_max: maxHp,
        seriouslywounded: halfHp,
        deathsave: deathSave
      });
    });
  }
  on('change:stat_body change:stat_will', function() {
    updateHitPoints();
  });
  /**
   * Automatically apply "seriously wounded" and "mortally wounded"
   * modifiers based on HP value.
   */
  function updateHpModifiers() {
    getAttrs(['hp', 'seriouslywounded'], function (values) {
      var hp = Number(values.hp);
      var threshold = Number(values.seriouslywounded);
      var damageserious = 0;
      var damagemortal = 0;
      if (hp < threshold) {
        damageserious = 'on'
      }
      if (hp < 1) {
        damagemortal = 'on'
      }
      setAttrs({
        damageserious: damageserious,
        damagemortal: damagemortal
      });
    });
  }
  on('change:hp', function() {
    updateHpModifiers();
  });
</script>

        </div>
      </div>
      <div>
        <div class="section-role">
          <input type="hidden" name="attr_role" />
          <div class="role-pane role-exec">
            <h4>Exec</h4>
            Teamwork
            <input type="number" name="attr_role_exec" />
          </div>
          <div class="role-pane role-fixer">
            <h4>Fixer</h4>
            Operator
            <input type="number" name="attr_role_fixer" />
          </div>
          <div class="role-pane role-lawman">
            <h4>Lawman</h4>
            Backup
            <input type="number" name="attr_role_lawman" />
          </div>
          <div class="role-pane role-media">
            <h4>Media</h4>
            Credibility
            <input type="number" name="attr_role_media" />
          </div>
          <div class="role-pane role-medtech">
            <h4>Medtech</h4>
            Medicine
            <input type="number" name="attr_role_medtech" />
            <hr />
            <div class="columns">
              <div class="column">
                Surgery<input type="number" name="attr_role_medtech_surgery" />
              </div>
              <div class="column">
                Pharmaceuticals<input type="number" name="attr_role_medtech_pharmaceuticals" />
              </div>
              <div class="column">
                Cryosystem Operation<input type="number" name="attr_role_medtech_cryosystem" />
              </div>
            </div>
          </div>
          <div class="role-pane role-netrunner">
            <h4>Netrunner</h4>
            Interface
            <input type="number" name="attr_role_netrunner" />
          </div>
          <div class="role-pane role-nomad">
            <h4>Nomad</h4>
            Moto
            <input type="number" name="attr_role_nomad" />
          </div>
          <div class="role-pane role-rockerboy">
            <h4>Rockerboy</h4>
            Charismatic Impact
            <input type="number" name="attr_role_rocker" />
          </div>
          <div class="role-pane role-solo">
            <h4>Solo</h4>
            Combat Awareness
            <input type="number" name="attr_role_solo" />
            [reset]
            <hr />
            <div class="columns">
              <div class="column">
                Damage Deflection<input type="number" name="attr_role_solo_damagedeflection" />
              </div>
              <div class="column">
                Fumble Recovery<input type="number" name="attr_role_solo_fumblerecovery" />
              </div>
              <div class="column">
                Initiative Reaction<input type="number" name="attr_role_solo_initiativereaction" />
              </div>
              <div class="column">
                Precision Attack<input type="number" name="attr_role_solo_precisionattack" />
              </div>
              <div class="column">
                Spot Weakness<input type="number" name="attr_role_solo_spotweakness" />
              </div>
              <div class="column">
                Threat Detection<input type="number" name="attr_role_solo_threatdetection" />
              </div>
            </div>
          </div>
          <div class="role-pane role-tech">
            <h4>Tech</h4>
            Maker
            <input type="number" name="attr_role_tech" />
          </div>
        </div>

      </div>
      <div>
        <div class="columns">
          <div class="column">
            <div class="section-ip">
              <h4>Improvement Points</h4>
              <div class="field-wrapper center">
                <input type="number" name="attr_ip" value="0" /> of
                <input type="number" name="attr_ip_max" value="0" />
              </div>
            </div>

          </div>
          <div class="column">
            <div class="section-reputation">
              <h4>Reputation</h4>
              <div class="field-wrapper center">
                <input type="text" name="attr_reputation" />
              </div>
            </div>

          </div>
        </div>
      </div>
      <div>
        <div class="section-dice-roller">
          Show Dice Rollers?
          <input type="checkbox" value="0" class="show-next-div" />
          <div class="dice-roller-pane">
            <div class="columns">
              <div class="column">
                <button type="roll" name="roll_1d10" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll 1d10}} {{roll=[[1d10]]}}">
                  Roll 1d10
                </button>
              </div>
              <div class="column">
                <select name="attr_rollnd6" style="width: 5rem">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                </select>
                <button type="roll" name="roll_d6" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll @{rollnd6}d6}} {{roll=[[@{rollnd6}d6]]}}">
                  Roll d6
                </button>
              </div>
              <div class="column">
                <button type="roll" name="roll_1d100" value="&{template:basic}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Roll 1d100}} {{roll=[[1d100]]}}">
                  Roll 1d100
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-content tab2">
      <!-- modifiers controller component -->
      <div class="section-modifiers">
        <div class="modifiers">
          <input type="hidden" name="attr_finalmodifier" />
          <h4>
            Modifiers
            <span name="attr_finalmodifierdisplay"></span>
            <span class="faux-button">
        Reset
        <input type="checkbox" name="attr_resetmodifiers"
      /></span>
          </h4>
          <div class="modifiers-body">
            Show Modifiers?
            <input type="checkbox" name="attr_hidemodifiers" class="show-next-div" />
            <div class="toggle-container">
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_damageserious" /> Damage: Serious
                  <small>(HP &lt; <span name="attr_seriouslywounded"></span>)</small>
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_damagemortal" /> Damage: Mortal
                  <small>(HP &lt; 1)</small>
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_understress" /> Under stress
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_neverdonebefore" /> Never done
                  before
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_nightorlowlight" /> Night or low
                  light
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_obscured" /> Obscured by smoke or
                  darkness
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_complextask" /> Complex task
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_wrongtoolsorparts" /> Wrong tools
                  or parts
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_drunkdrugged" /> Drunk or Drugged
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_secretly" /> Attempting secretly
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_lostfacedown" /> Lost facedown
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_aimedshot" /> Aimed shot
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_complimentaryskill" />
                  Complimentary skill
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_extratime" /> Spend extra time
                </div>
                <div class="column">
                  Other/custom
                  <input type="number" name="attr_custommod" />
                </div>
                <div class="column">
                  Luck points spent
                  <select name="attr_luckmod">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script type="text/worker">
        /**
   * Convert from Roll20's handling of checkbox values to
   * Boolean values for control flows.
   */
  function getCheckboxAsBoolean(val) {
    // Additional logic to handle the custommod and luckmod fields
    if (Number(val) && Number(val) !== 0) {
      return true;
    }
    return val === 'on' ? true : false;
  }
  /**
   * A list of modifiers that we can iterate through with a
   * name that matches an ATTR value stored by the sheet and
   * the actual numerical modifier to be applied to die rolls.
   */
  function modifiersList() {
    return [
      { name: 'nightorlowlight', value: -1 },
      { name: 'neverdonebefore', value: -1 },
      { name: 'complextask', value: -2 },
      { name: 'wrongtoolsorparts', value: -2 },
      { name: 'understress', value: -2 },
      { name: 'drunkdrugged', value: -4 },
      { name: 'secretly', value: -4 },
      { name: 'obscured', value: -4 },
      { name: 'damageserious', value: -2 },
      { name: 'damagemortal', value: -4 },
      { name: 'lostfacedown', value: -2 },
      { name: 'complimentaryskill', value: 1 },
      { name: 'extratime', value: 1 },
      { name: 'aimedshot', value: -8 },
      { name: 'luckmod', value: 'luckmod' },
      { name: 'custommod', value: 'custommod' }
    ];
  }
  /**
   * Get modifiers as an array of names as Strings.
   */
  function getModifierNames() {
    var modifiers = modifiersList();
    var modifierNames = [];
    modifiers.forEach((modifier) => {
      modifierNames.push(modifier.name);
    });
    return modifierNames;
  }
  /**
   * Given the namme of a modifier return the numerical modifier
   * to be applied to die rolls.
   */
  function getModifierValueByName(name) {
    // LUCK and CUSTOM are special cases that map directly
    // to attr values stored in the sheet.
    if (name === 'luckmod' || name === 'custommod') {
      getAttrs([name], function (values) {
        return values[name];
      });
    }
    // MOST MODIFIERS are static numbers that have their values
    // stored as part of the data structure in modifiersList().
    var modifiers = modifiersList();
    return modifiers.find((modifier) => modifier.name === name).value;
  }
  /**
   * Calculate the final modifier...
   */
  function calculateFinalModifier() {
    var calculatedFinalModifier = 0;
    getAttrs(getModifierNames(), function (values) {
      for (var [key, value] of Object.entries(values)) {
        if (getCheckboxAsBoolean(value)) {
          if (key === 'luckmod' || key === 'custommod') {
            calculatedFinalModifier += Number(values[key]);
          } else {
            calculatedFinalModifier += Number(getModifierValueByName(key));
          }
        }
      }
      if (calculatedFinalModifier === 0) {
        calculatedFinalModifier = '0';
      }
      setAttrs({
        finalmodifier: calculatedFinalModifier
      });
    });
  }
  // Get the (formatted) list of modifier fields to monitor for changes
  function eventsModifiers() {
    var modifiers = getModifierNames();
    var modifiersList = '';
    modifiers.forEach((modifier) => {
      modifiersList += 'change:' + modifier + ' ';
    });
    return modifiersList;
  }
  /**
   * When a modifier checkbox changes, trigger the re-calculation of
   * the finalmodifier.
   */
  on(eventsModifiers(), function () {
    calculateFinalModifier();
  });
  /**
   * When the finalmodifier changes re-write the display version of
   * the calculated modifier
   */
  on('change:finalmodifier', function () {
    getAttrs(['finalmodifier', 'finalmodifierdisplay'], function (values) {
      var modifier = Number(values.finalmodifier);
      var formattedmodifier = ' ';
      if (modifier > 0) {
        formattedmodifier = '(+' + modifier + ')';
      }
      if (modifier < 0) {
        formattedmodifier = '(' + modifier + ')';
      }
      setAttrs({
        finalmodifierdisplay: formattedmodifier
      });
    });
  });
  /**
   * Single function to reset all modifiers
   */
  function resetAllModifiers() {
    var modifiers = getModifierNames();
    var attrsToSet = {};
    getAttrs(modifiers, function (values) {
      for (var [key, value] of Object.entries(values)) {
        attrsToSet[key] = '0';
      }
      setAttrs(attrsToSet);
    });
  }
  /**
   * Event handler to trigger reset of all modifiers
   */
  on('change:resetmodifiers', function () {
    resetAllModifiers();
  });
</script>

      <!-- skills component -->
      <div class="section-skills">
        <div class="skills-list-grouped">

          <div class="skill-group">
            <h4 class="accent-font">Awareness Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_concealrevealobject" />
                  <button class="button-plain" type="roll">
                    Conceal/Reveal Object
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_concentration" />
                  <button class="button-plain" type="roll">
                    Concentration
                    <span class="skill-meta"
                >(will
                <span name="attr_stat_will"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_lipreading" />
                  <button class="button-plain" type="roll">
                    Lip Reading
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_perception" />
                  <button class="button-plain" type="roll">
                    Perception
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_tracking" />
                  <button class="button-plain" type="roll">
                    Tracking
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Body Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_athletics" />
                  <button class="button-plain" type="roll">
                    Athletics
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_contrortionist" />
                  <button class="button-plain" type="roll">
                    Contrortionist
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_dance" />
                  <button class="button-plain" type="roll">
                    Dance
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_endurance" />
                  <button class="button-plain" type="roll">
                    Endurance
                    <span class="skill-meta"
                >(will
                <span name="attr_stat_will"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_resisttorturedrugs" />
                  <button class="button-plain" type="roll">
                    Resist Torture/Drugs
                    <span class="skill-meta"
                >(will
                <span name="attr_stat_will"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_stealth" />
                  <button class="button-plain" type="roll">
                    Stealth
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Control Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_landvehicle" />
                  <button class="button-plain" type="roll">
                    Control Land Vehicle
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_airvehicle" />
                  <button class="button-plain" type="roll">
                    Pilot Air Vehicle (x2)
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_seavehicle" />
                  <button class="button-plain" type="roll">
                    Pilot Sea Vehicle
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_riding" />
                  <button class="button-plain" type="roll">
                    Riding
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Education Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_accounting" />
                  <button class="button-plain" type="roll">
                    Accounting
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_animalhandling" />
                  <button class="button-plain" type="roll">
                    Animal Handling
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_bureaucracy" />
                  <button class="button-plain" type="roll">
                    Bureaucracy
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_business" />
                  <button class="button-plain" type="roll">
                    Business
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_composition" />
                  <button class="button-plain" type="roll">
                    Composition
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_criminology" />
                  <button class="button-plain" type="roll">
                    Criminology
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_cryptography" />
                  <button class="button-plain" type="roll">
                    Cryptography
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_deduction" />
                  <button class="button-plain" type="roll">
                    Deduction
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_education" />
                  <button class="button-plain" type="roll">
                    Education
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_gamble" />
                  <button class="button-plain" type="roll">
                    Gamble
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_librarysearch" />
                  <button class="button-plain" type="roll">
                    Library Search
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_tactics" />
                  <button class="button-plain" type="roll">
                    Tactics
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_wildernesssurvival" />
                  <button class="button-plain" type="roll">
                    Wilderness Survival
                    <span class="skill-meta"
                >(int
                <span name="attr_stat_int"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <h5 class="accent-font">
                  Languages
                  <span class="skill-meta"
              >(int
              <span name="attr_stat_int"></span>)</span>
                </h5>
                <fieldset class="repeating_languages">
                  <div class="skill">
                    <input class="skill-value" type="number" value="0" name="attr_skillvalue" />
                    <span class="skill-indent-icon">&#8627;</span>
                    <button class="button-plain" type="roll"></button>
                    <input class="skill-name" type="text" name="attr_skillname" />
                  </div>
                </fieldset>

              </li>

              <li>

                <h5 class="accent-font">
                  Local Expert
                  <span class="skill-meta"
              >(int
              <span name="attr_stat_int"></span>)</span>
                </h5>
                <fieldset class="repeating_localexperts">
                  <div class="skill">
                    <input class="skill-value" type="number" value="0" name="attr_skillvalue" />
                    <span class="skill-indent-icon">&#8627;</span>
                    <button class="button-plain" type="roll"></button>
                    <input class="skill-name" type="text" name="attr_skillname" />
                  </div>
                </fieldset>

              </li>

              <li>

                <h5 class="accent-font">
                  Science
                  <span class="skill-meta"
              >(int
              <span name="attr_stat_int"></span>)</span>
                </h5>
                <fieldset class="repeating_sciences">
                  <div class="skill">
                    <input class="skill-value" type="number" value="0" name="attr_skillvalue" />
                    <span class="skill-indent-icon">&#8627;</span>
                    <button class="button-plain" type="roll"></button>
                    <input class="skill-name" type="text" name="attr_skillname" />
                  </div>
                </fieldset>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Fighting Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_brawling" />
                  <button class="button-plain" type="roll">
                    Brawling
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_evasion" />
                  <button class="button-plain" type="roll">
                    Evasion
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_meleeweapon" />
                  <button class="button-plain" type="roll">
                    Melee Weapon
                    <span class="skill-meta"
                >(dex
                <span name="attr_stat_dex"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <h5 class="accent-font">
                  Martial Arts (x2)
                  <span class="skill-meta"
              >(dex
              <span name="attr_stat_dex"></span>)</span>
                </h5>
                <fieldset class="repeating_martialarts">
                  <div class="skill">
                    <input class="skill-value" type="number" value="0" name="attr_skillvalue" />
                    <span class="skill-indent-icon">&#8627;</span>
                    <button class="button-plain" type="roll"></button>
                    <input class="skill-name" type="text" name="attr_skillname" />
                  </div>
                </fieldset>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Performance Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_acting" />
                  <button class="button-plain" type="roll">
                    Acting
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <h5 class="accent-font">
                  Play Instrument
                  <span class="skill-meta"
              >(tech
              <span name="attr_stat_tech"></span>)</span>
                </h5>
                <fieldset class="repeating_playinstrument">
                  <div class="skill">
                    <input class="skill-value" type="number" value="0" name="attr_skillvalue" />
                    <span class="skill-indent-icon">&#8627;</span>
                    <button class="button-plain" type="roll"></button>
                    <input class="skill-name" type="text" name="attr_skillname" />
                  </div>
                </fieldset>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Ranged Weapon Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_archery" />
                  <button class="button-plain" type="roll">
                    Archery
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_autofire" />
                  <button class="button-plain" type="roll">
                    Autofire (x2)
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_handgun" />
                  <button class="button-plain" type="roll">
                    Handgun
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_heavyweapons" />
                  <button class="button-plain" type="roll">
                    Heavy Weapons
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_shoulderarms" />
                  <button class="button-plain" type="roll">
                    Shoulder Arms
                    <span class="skill-meta"
                >(ref
                <span name="attr_stat_ref"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Social Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_bribery" />
                  <button class="button-plain" type="roll">
                    Bribery
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_conversation" />
                  <button class="button-plain" type="roll">
                    Conversation
                    <span class="skill-meta"
                >(emp
                <span name="attr_stat_emp"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_humanperception" />
                  <button class="button-plain" type="roll">
                    Human Perception
                    <span class="skill-meta"
                >(emp
                <span name="attr_stat_emp"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_interrogation" />
                  <button class="button-plain" type="roll">
                    Interrogation
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_personalgrooming" />
                  <button class="button-plain" type="roll">
                    Personal Grooming
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_persuasion" />
                  <button class="button-plain" type="roll">
                    Persuasion
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_bribery" />
                  <button class="button-plain" type="roll">
                    Streetwise
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_bribery" />
                  <button class="button-plain" type="roll">
                    Trading
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_wardrobestyle" />
                  <button class="button-plain" type="roll">
                    Wardrobe & Style
                    <span class="skill-meta"
                >(cool
                <span name="attr_stat_cool"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

          <div class="skill-group">
            <h4 class="accent-font">Technique Skills</h4>
            <ul class="list-plain">

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_airevehicletech" />
                  <button class="button-plain" type="roll">
                    Air Vehicle Tech
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_basictech" />
                  <button class="button-plain" type="roll">
                    Basic Tech
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_cybertech" />
                  <button class="button-plain" type="roll">
                    Cybertech
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_demolitions" />
                  <button class="button-plain" type="roll">
                    Demolitions (x2)
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_electronicssecurity" />
                  <button class="button-plain" type="roll">
                    Electronics/Security Tech (x2)
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_forgery" />
                  <button class="button-plain" type="roll">
                    Forgery
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_firstaid" />
                  <button class="button-plain" type="roll">
                    First Aid
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_landvehicletech" />
                  <button class="button-plain" type="roll">
                    Land Vehicle Tech
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_paintdrawsculpt" />
                  <button class="button-plain" type="roll">
                    Paint/Draw/Sculpt
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_paramedic" />
                  <button class="button-plain" type="roll">
                    Paramedic (x2)
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_photographyfilm" />
                  <button class="button-plain" type="roll">
                    Photography/Film
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_picklock" />
                  <button class="button-plain" type="roll">
                    Pick Lock
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_pickpocket" />
                  <button class="button-plain" type="roll">
                    Pick Pocket
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

              <li>

                <div class="skill">
                  <input class="skill-value" type="number" value="0" name="attr_skill_weaponstech" />
                  <button class="button-plain" type="roll">
                    Weaponstech
                    <span class="skill-meta"
                >(tech
                <span name="attr_stat_tech"></span>)</span>
                  </button>
                </div>

              </li>

            </ul>
          </div>

        </div>
      </div>

    </div>
    <div class="tab-content tab3">
      <!-- modifiers controller component -->
      <div class="section-modifiers">
        <div class="modifiers">
          <input type="hidden" name="attr_finalmodifier" />
          <h4>
            Modifiers
            <span name="attr_finalmodifierdisplay"></span>
            <span class="faux-button">
        Reset
        <input type="checkbox" name="attr_resetmodifiers"
      /></span>
          </h4>
          <div class="modifiers-body">
            Show Modifiers?
            <input type="checkbox" name="attr_hidemodifiers" class="show-next-div" />
            <div class="toggle-container">
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_damageserious" /> Damage: Serious
                  <small>(HP &lt; <span name="attr_seriouslywounded"></span>)</small>
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_damagemortal" /> Damage: Mortal
                  <small>(HP &lt; 1)</small>
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_understress" /> Under stress
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_neverdonebefore" /> Never done
                  before
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_nightorlowlight" /> Night or low
                  light
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_obscured" /> Obscured by smoke or
                  darkness
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_complextask" /> Complex task
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_wrongtoolsorparts" /> Wrong tools
                  or parts
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_drunkdrugged" /> Drunk or Drugged
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_secretly" /> Attempting secretly
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_lostfacedown" /> Lost facedown
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_aimedshot" /> Aimed shot
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <input type="checkbox" name="attr_complimentaryskill" />
                  Complimentary skill
                </div>
                <div class="column">
                  <input type="checkbox" name="attr_extratime" /> Spend extra time
                </div>
                <div class="column">
                  Other/custom
                  <input type="number" name="attr_custommod" />
                </div>
                <div class="column">
                  Luck points spent
                  <select name="attr_luckmod">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script type="text/worker">
        /**
   * Convert from Roll20's handling of checkbox values to
   * Boolean values for control flows.
   */
  function getCheckboxAsBoolean(val) {
    // Additional logic to handle the custommod and luckmod fields
    if (Number(val) && Number(val) !== 0) {
      return true;
    }
    return val === 'on' ? true : false;
  }
  /**
   * A list of modifiers that we can iterate through with a
   * name that matches an ATTR value stored by the sheet and
   * the actual numerical modifier to be applied to die rolls.
   */
  function modifiersList() {
    return [
      { name: 'nightorlowlight', value: -1 },
      { name: 'neverdonebefore', value: -1 },
      { name: 'complextask', value: -2 },
      { name: 'wrongtoolsorparts', value: -2 },
      { name: 'understress', value: -2 },
      { name: 'drunkdrugged', value: -4 },
      { name: 'secretly', value: -4 },
      { name: 'obscured', value: -4 },
      { name: 'damageserious', value: -2 },
      { name: 'damagemortal', value: -4 },
      { name: 'lostfacedown', value: -2 },
      { name: 'complimentaryskill', value: 1 },
      { name: 'extratime', value: 1 },
      { name: 'aimedshot', value: -8 },
      { name: 'luckmod', value: 'luckmod' },
      { name: 'custommod', value: 'custommod' }
    ];
  }
  /**
   * Get modifiers as an array of names as Strings.
   */
  function getModifierNames() {
    var modifiers = modifiersList();
    var modifierNames = [];
    modifiers.forEach((modifier) => {
      modifierNames.push(modifier.name);
    });
    return modifierNames;
  }
  /**
   * Given the namme of a modifier return the numerical modifier
   * to be applied to die rolls.
   */
  function getModifierValueByName(name) {
    // LUCK and CUSTOM are special cases that map directly
    // to attr values stored in the sheet.
    if (name === 'luckmod' || name === 'custommod') {
      getAttrs([name], function (values) {
        return values[name];
      });
    }
    // MOST MODIFIERS are static numbers that have their values
    // stored as part of the data structure in modifiersList().
    var modifiers = modifiersList();
    return modifiers.find((modifier) => modifier.name === name).value;
  }
  /**
   * Calculate the final modifier...
   */
  function calculateFinalModifier() {
    var calculatedFinalModifier = 0;
    getAttrs(getModifierNames(), function (values) {
      for (var [key, value] of Object.entries(values)) {
        if (getCheckboxAsBoolean(value)) {
          if (key === 'luckmod' || key === 'custommod') {
            calculatedFinalModifier += Number(values[key]);
          } else {
            calculatedFinalModifier += Number(getModifierValueByName(key));
          }
        }
      }
      if (calculatedFinalModifier === 0) {
        calculatedFinalModifier = '0';
      }
      setAttrs({
        finalmodifier: calculatedFinalModifier
      });
    });
  }
  // Get the (formatted) list of modifier fields to monitor for changes
  function eventsModifiers() {
    var modifiers = getModifierNames();
    var modifiersList = '';
    modifiers.forEach((modifier) => {
      modifiersList += 'change:' + modifier + ' ';
    });
    return modifiersList;
  }
  /**
   * When a modifier checkbox changes, trigger the re-calculation of
   * the finalmodifier.
   */
  on(eventsModifiers(), function () {
    calculateFinalModifier();
  });
  /**
   * When the finalmodifier changes re-write the display version of
   * the calculated modifier
   */
  on('change:finalmodifier', function () {
    getAttrs(['finalmodifier', 'finalmodifierdisplay'], function (values) {
      var modifier = Number(values.finalmodifier);
      var formattedmodifier = ' ';
      if (modifier > 0) {
        formattedmodifier = '(+' + modifier + ')';
      }
      if (modifier < 0) {
        formattedmodifier = '(' + modifier + ')';
      }
      setAttrs({
        finalmodifierdisplay: formattedmodifier
      });
    });
  });
  /**
   * Single function to reset all modifiers
   */
  function resetAllModifiers() {
    var modifiers = getModifierNames();
    var attrsToSet = {};
    getAttrs(modifiers, function (values) {
      for (var [key, value] of Object.entries(values)) {
        attrsToSet[key] = '0';
      }
      setAttrs(attrsToSet);
    });
  }
  /**
   * Event handler to trigger reset of all modifiers
   */
  on('change:resetmodifiers', function () {
    resetAllModifiers();
  });
</script>

      <!-- main combat component (weapons and attacks/damage) -->
      <div class="section-combat">
        <div class="combat-weapons">
          <h4 class="accent-font">Weapons</h4>
          <fieldset class="repeating_weapons">
            <div class="weapon">
              <div class="columns">
                <div class="column">
                  <div class="accent-font">Name</div>
                  <input type="text" name="attr_weaponname" />
                </div>
                <div class="column">
                  <div class="accent-font">Skill</div>
                  <select name="attr_weaponskill">
                    <optgroup label="Melee">
                      <option value="brawling">Brawling</option>
                      <option value="meleeweapon">Melee Weapon</option>
                      <option value="martialarts">Martial Arts</option>
                    </optgroup>
                    <optgroup label="Ranged">
                      <option value="archery">Archery</option>
                      <option value="handgun">Handgun</option>
                      <option value="heavyweapons">Heavy Weapons</option>
                      <option value="shoulderarms">Shoulder Arms</option>
                    </optgroup>
                  </select>
                </div>
                <div class="column">
                  <div class="accent-font">Damage</div>
                  <select class="narrow" name="attr_weapondamage">
                    <option value="1">1d6</option>
                    <option value="2">2d6</option>
                    <option value="3">3d6</option>
                    <option value="4">4d6</option>
                    <option value="5">5d6</option>
                    <option value="6">6d6</option>
                    <option value="7">7d6</option>
                    <option value="8">8d6</option>
                    <option value="9">9d6</option>
                    <option value="10">10d6</option>
                  </select>
                </div>
                <div class="column">
                  <div class="accent-font">Magazine</div>
                  <input class="narrow" type="text" name="attr_weaponmagazine" />
                </div>
                <div class="column">
                  <div class="accent-font">
                    <abbr title="Rate of Fire">RoF</abbr>
                  </div>
                  <select class="narrow" name="attr_weaponrof">
                    <option value="1">1</option>
                    <option value="2">2</option>
                  </select>
                </div>
              </div>
              <div class="columns">
                <div class="column">
                  <div class="weapon-ammotype">
                    <span class="accent-font">Ammo Type</span>
                    <input type="text" name="attr_weaponammotype" />
                  </div>
                  <div class="weapon-concealable">
                    <span class="accent-font">
                <input type="checkbox" name="attr_weaponconcealable" />
                Concealable
              </span>
                  </div>
                </div>
                <div class="column column-3">
                  <div class="accent-font">Notes</div>
                  <textarea name="attr_weaponnotes" rows="3"></textarea>
                </div>
              </div>
              <div class="actions">
                <button type="roll" name="roll_1d10" value="&{template:attack}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Attack: @{weaponname}}} {{roll=[[1d10]]}}">
                  Attack
                </button>
                <button type="roll" name="roll_1d10" value="&{template:attack}{{templatecolor=@{templatecolor}}} {{charactername=@{charactername}}} {{header=Attack: @{weaponname}}} {{roll=[[1d10]]}}">
                  Damage
                </button>
              </div>
            </div>
          </fieldset>
        </div>
        <div class="columns">
          <div class="column">
            <div class="armor">
              <div class="columns armor-headers">
                <div class="column column-5">
                  <h4>Armor</h4>
                </div>
                <div class="column">
                  <h4>SP</h4>
                </div>
                <div class="column">
                  <h4>(Max)</h4>
                </div>
                <div class="column">
                  <h4>
                    <div style="width: 5.5rem">Mod</div>
                  </h4>
                </div>
                <div class="column">
                  <h4>Eq</h4>
                </div>
              </div>
              <div class="armor-items">
                <div class="columns">
                  <div class="column">Body</div>
                  <div class="column column-4">
                    <input type="text" name="attr_armorname" />
                  </div>
                  <div class="column"><input type="number" name="attr_armor" /></div>
                  <div class="column">
                    <input type="number" name="attr_armor_max" />
                  </div>
                  <div class="column">
                    <select name="attr_armor_penalty">
                      <option value="0">0</option>
                      <option value="-2">-2</option>
                      <option value="-4">-4</option>
                    </select>
                  </div>
                  <div class="column">
                    <input type="checkbox" name="attr_armor_equipped" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column">Head</div>
                  <div class="column column-4">
                    <input type="text" name="attr_armorheadname" />
                  </div>
                  <div class="column">
                    <input type="number" name="attr_armorhead" />
                  </div>
                  <div class="column">
                    <input type="number" name="attr_armorhead_max" />
                  </div>
                  <div class="column">
                    <select name="attr_armorhead_penalty">
                      <option value="0">0</option>
                      <option value="-2">-2</option>
                      <option value="-4">-4</option>
                    </select>
                  </div>
                  <div class="column">&nbsp;</div>
                </div>
                <div class="columns">
                  <div class="column">Shield</div>
                  <div class="column column-4">
                    <input type="text" name="attr_armorshieldname" />
                  </div>
                  <div class="column">
                    <input type="number" name="attr_armorshield" />
                  </div>
                  <div class="column">
                    <input type="number" name="attr_armorshield_max" />
                  </div>
                  <div class="column">
                    <select name="attr_armorshield_penalty">
                      <option value="0">0</option>
                      <option value="-2">-2</option>
                      <option value="-4">-4</option>
                    </select>
                  </div>
                  <div class="column">&nbsp;</div>
                </div>
              </div>
            </div>
          </div>
          <div class="column">
            <div class="ammo">
              <div class="columns ammo-headers">
                <div class="column column-5">
                  <h4>Ammo</h4>
                </div>
                <div class="column">
                  <h4>Qty</h4>
                </div>
              </div>
              <div class="ammo-items">
                <fieldset class="repeating_ammo">
                  <div class="columns">
                    <div class="column column-5">
                      <input type="text" name="attr_ammoname" />
                    </div>
                    <div class="column">
                      <input type="number" name="attr_ammoquantity" />
                    </div>
                  </div>
                </fieldset>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="tab-content tab4">
      <div class="section-gear">
        <div class="gear">
          <div class="gear-headers columns">
            <div class="column">
              <h4>Gear</h4>
            </div>
            <div class="column column-3">
              <h4>Notes</h4>
            </div>
          </div>
          <div class="gear-items">
            <fieldset class="repeating_gear">
              <div class="columns">
                <div class="column"><input type="text" name="attr_gear_name" /></div>
                <div class="column column-3">
                  <textarea name="attr_gear_desc"></textarea>
                </div>
              </div>
            </fieldset>
          </div>
        </div>
        <div class="gear-meta">
          <div class="columns">
            <div class="column">
              <h4>Fashion</h4>
              <div class="gear-meta-wrapper">
                <textarea name="attr_fashion"></textarea>
              </div>
            </div>
            <div class="column">
              <h4>Housing</h4>
              <div class="gear-meta-wrapper">
                <textarea name="attr_housing"></textarea>
              </div>
            </div>
          </div>
          <div class="columns">
            <div class="column">
              <h4>Rent</h4>
              <div class="gear-meta-wrapper">
                <input type="text" name="attr_rent" />
              </div>
            </div>
            <div class="column">
              <h4>Lifestyle</h4>
              <div class="gear-meta-wrapper">
                <input type="text" name="attr_lifestyle" />
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="tab-content tab5">
      <div class="section-cyberware">
        <div class="columns">
          <div class="column">
            <div class="cyberware-group">
              <h4>Cyberaudio</h4>
              <fieldset class="repeating_cyberaudio">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Right Cybereye</h4>
              <fieldset class="repeating_cybereyeright">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Left Cybereye</h4>
              <fieldset class="repeating_cybereyeleft">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Right Cyberarm</h4>
              <fieldset class="repeating_cyberarmright">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Left Cyberarm</h4>
              <fieldset class="repeating_cyberarmleft">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Neural Link</h4>
              <fieldset class="repeating_cyberneurallink">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Right Cyberleg</h4>
              <fieldset class="repeating_cyberlegright">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Left Cyberleg</h4>
              <fieldset class="repeating_cyberlefleft">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
          <div class="column">
            <div class="cyberware-group">
              <h4>Internal Cyberware</h4>
              <fieldset class="repeating_cyberinternal">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>External Cyberware</h4>
              <fieldset class="repeating_cyberexternal">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Fashionware</h4>
              <fieldset class="repeating_cyberfashion">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
            <div class="cyberware-group">
              <h4>Borgware</h4>
              <fieldset class="repeating_cyberborg">
                <div class="columns">
                  <div class="column label">Name</div>
                  <div class="column column-5">
                    <input type="text" name="attr_cyberwarename" />
                  </div>
                </div>
                <div class="columns">
                  <div class="column label">Data</div>
                  <div class="column column-5">
                    <textarea name="attr_cyberwaredesc"></textarea>
                  </div>
                </div>
              </fieldset>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="tab-content tab6">
      <div class="section-lifepath">
        <div class="lifepath-role">
          <input type="hidden" name="attr_role" />
          <div class="lp lp-exec">Exec</div>
          <div class="lp lp-fixer">Fixer</div>
          <div class="lp lp-lawman">Lawman</div>
          <div class="lp lp-media">Media</div>
          <div class="lp lp-medtech">Medtech</div>
          <div class="lp lp-netrunner">Netrunner</div>
          <div class="lp lp-nomad">Nomad</div>
          <div class="lp lp-rockerboy">Rockerboy</div>
          <div class="lp lp-solo">Solo</div>
          <div class="lp lp-tech">Tech</div>
        </div>
        <div class="columns">
          <div class="column">
            <div class="lifepath-group">
              <h4>Cultural Origins</h4>
              <textarea name="attr_lp_culture"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Clothing Style</h4>
              <textarea name="attr_lp_clothing"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>What do you value most?</h4>
              <textarea name="attr_lp_whatdoyouvalue"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Most valued person</h4>
              <textarea name="attr_lp_mostvaluedperson"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Family Background</h4>
              <textarea name="attr_lp_familybackground"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Family Crisis</h4>
              <textarea name="attr_lp_familycrisis"></textarea>
            </div>
          </div>
          <div class="column">
            <div class="lifepath-group">
              <h4>Personality</h4>
              <textarea name="attr_lp_personality"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Hairstyle</h4>
              <textarea name="attr_lp_hairstyle"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Feelings about people</h4>
              <textarea name="attr_lp_feelingsaboutpeople"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Most valued possession</h4>
              <textarea name="attr_lp_mostvaluedpossession"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Childhood environment</h4>
              <textarea name="attr_lp_childhoodenv"></textarea>
            </div>
            <div class="lifepath-group">
              <h4>Life Goals</h4>
              <textarea name="attr_lp_lifegoals"></textarea>
            </div>
          </div>
        </div>
        <div class="columns">
          <div class="column">
            <h4 class="accent-font">Friends</h4>
            <fieldset class="repeating_friends">
              <textarea name="attr_lp_friend"></textarea>
            </fieldset>
          </div>
          <div class="column">
            <h4 class="accent-font">Tragic Love Affairs</h4>
            <fieldset class="repeating_loveaffairs">
              <textarea name="attr_lp_loveaffair"></textarea>
            </fieldset>
          </div>
        </div>
        <div>
          <h4>Enemies</h4>
          <div class="columns enemy-headers">
            <div class="column">Who are they?</div>
            <div class="column">What caused it?</div>
            <div class="column">What can they throw at you?</div>
            <div class="column">What's gonna happen?</div>
          </div>
          <fieldset class="repeating_enemies">
            <div class="enemy">
              <div class="columns">
                <div class="column">
                  <textarea name="attr_lp_enemywho"></textarea>
                </div>
                <div class="column">
                  <textarea name="attr_lp_enemycause"></textarea>
                </div>
                <div class="column">
                  <textarea name="attr_lp_enemythrow"></textarea>
                </div>
                <div class="column">
                  <textarea name="attr_lp_enemyhappen"></textarea>
                </div>
              </div>
            </div>
          </fieldset>
        </div>
      </div>

    </div>
    <!-- <div class="tab-content tab7">
      <div class="section-settings">
  <h3 class="accent-font">Settings</h3>
  <div class="setting-color">
    <h4 class="accent-font">Color</h4>
    <select name="attr_templatecolor">
      <option value="black">Black</option>
      <option value="red">Red</option>
      <option value="blue">Blue</option>
      <option value="green">Green</option>
      <option value="brown">Brown</option>
    </select>
  </div>
</div>

    </div> -->
  </div>

  <!-- Roll templates... -->
  <!-- attack rolls -->
  <!-- Roll template: Combat - Attack -->
  <rolltemplate class="sheet-rolltemplate-attack">
    <div class="{{ templatecolor }}">
      <div>(attack roll)</div>
      <div class="character">
        {{#charactername}}{{ charactername }}{{/charactername}}
      </div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>
      {{#rollWasCrit() roll}}
        <div class="crit">
          CRITICAL SUCCESS! <br />
          Add {{ critroll }} to roll
        </div>
      {{/rollWasCrit() roll}} {{#rollWasFumble() roll}}
        <div class="fail">
          CRITICAL FAILURE! <br />
          Subtract {{ critroll }} from roll
        </div>
      {{/rollWasFumble() roll}} {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>

  <!-- basic rolls -->
  <!-- Roll template: Basic -->
  <rolltemplate class="sheet-rolltemplate-basic">
    <input type="hidden" name="attr_templatecolor" />
    <div class="sheet-templatecolor-wrapper">
      <div>(basic roll)</div>
      <div class="character">
        {{#charactername}}{{ charactername }}{{/charactername}}
      </div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>
      {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>

  <!-- damage rolls -->
  <!-- Roll template: Combat - Damage -->
  <rolltemplate class="sheet-rolltemplate-damage">
    <div class="{{ templatecolor }}">
      <div>(damage roll)</div>
      <div class="character">
        {{#charactername}}{{ charactername }}{{/charactername}}
      </div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>
      {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>

  <!-- skill rolls -->
  <!-- Roll template: Skill -->
  <rolltemplate class="sheet-rolltemplate-skill">
    <div class="{{ templatecolor }}">
      <div>(skill roll)</div>
      <div class="character">
        {{#charactername}}{{ charactername }}{{/charactername}}
      </div>
      <div class="header">{{#header}}{{ header }}{{/header}}</div>
      <div class="roll">{{ roll }}</div>
      {{#rollWasCrit() roll}}
        <div class="crit">CRITICAL SUCCESS! Add {{ critroll }} to roll</div>
      {{/rollWasCrit() roll}} {{#rollWasFumble() roll}}
        <div class="fail">CRITICAL FAILURE! Subtract {{ critroll }} from roll</div>
      {{/rollWasFumble() roll}} {{#footer}}
        <div class="footer">{{ footer }}</div>
      {{/footer}}
    </div>
  </rolltemplate>

</div>
<script src="main.js"></script>